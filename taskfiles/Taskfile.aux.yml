version: '3'

vars:
  # Directories
  CONFIG_DIR: './config'
  SCRIPTS_DIR: './scripts'
  BUILD_DIR: '{{.BUILD_DIR | default ".build"}}'

tasks:
  # Removes the build directory and the task cache
  clean:
    desc: Remove build directory, task cache, and bash history
    cmds:
      - rm -rf .task {{.BUILD_DIR}} .bash_history

  # Returns found TODOs in the project
  todo:
    desc: Search for TODOs in the project
    cmds:
      - grep --exclude-dir={.cache,.git,.task,.build} -rwo -n . --regexp 'TODO[:(].*'

  # Outputs a graph representation of a YAML file
  graph:
    desc: Generate graph representation of a YAML file
    cmds:
      - yml2dot {{.CLI_ARGS}} | dot -Tpng > {{.CLI_ARGS}}.png

  # Prints out the current setup
  default:
    desc: Display the current setup
    cmds:
      - |
        echo Running in: $(pwd) as $(whoami)
        echo OS: {{OS}}:{{ARCH}}
        echo Time: {{now | date "2006-01-02 15:04:05"}}
        echo Build directory: {{.BUILD_DIR}}
        echo Config directory: {{.CONFIG_DIR}}
        echo Scripts directory: {{.SCRIPTS_DIR}}
        echo Build directory: {{.BUILD_DIR}}
