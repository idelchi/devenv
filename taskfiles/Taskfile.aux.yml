version: '3'

vars:
  # Directories
  CONFIG_DIR: './config'
  SCRIPTS_DIR: './scripts'
  BUILD_DIR: '{{.BUILD_DIR | default ".build"}}'

tasks:
  clean:
    desc: Clean up the project workspace
    summary: |
      This task removes the build directory, task cache, and bash history to clean up the project workspace.
    cmds:
      - rm -rf .task {{.BUILD_DIR}} .bash_history

  todo:
    desc: Find TODOs within the project
    summary: |
      This task searches for TODOs within the project files, excluding certain directories.
    cmds:
      - grep --exclude-dir={.cache,.git,.task,.build} -rwo -n . --regexp 'TODO[:(].*'

  graph:
    desc: Create a graph from a YAML file
    summary: |
      This task generates a graph representation of a YAML file and saves it as a PNG image.
    cmds:
      - yml2dot {{.CLI_ARGS}} | dot -Tpng > {{.CLI_ARGS}}.png

  default:
    desc: Show the current project setup
    summary: |
      This task displays the current project setup, including directory paths, operating system, and build information.
    cmds:
      - |
        echo Running in: $(pwd) as $(whoami)
        echo OS: {{OS}}:{{ARCH}}
        echo Time: {{now | date "2006-01-02 15:04:05"}}
        echo Build directory: {{.BUILD_DIR}}
        echo Config directory: {{.CONFIG_DIR}}
        echo Scripts directory: {{.SCRIPTS_DIR}}
        echo Build directory: {{.BUILD_DIR}}

  bp:
    desc: Best practices
    cmds:
      - test -f README.md || echo "README.md missing"
      - test -f LICENSE || echo "LICENSE missing"

  vs:
    desc: |
      Copies the file '{{.CLI_ARGS}}/.vscode/settings.json', places it in '.vscode/settings.json',
      and replaces the string 'config/' with '{{.CLI_ARGS}}/config/''
    cmds:
      - |
        cp {{.CLI_ARGS}}/.vscode/settings.json .vscode/settings.json
        sed -i 's/\bconfig[^=]/{{.CLI_ARGS}}/config/g' .vscode/settings.json