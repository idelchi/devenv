version: '3'

vars:
  # Directories
  CONFIG_DIR: './config'

tasks:
  lint:
    desc: Lint Python code
    summary: |
      This task checks Python code using black, isort, prospector, pyright, and ruff.
    cmds:
      - black --check --config={{.CONFIG_PYPROJECT}} .
      - isort --check --settings-file={{.CONFIG_PYPROJECT}} .
      - ruff check --config={{.CONFIG_PYPROJECT}} .
      - |
        mypy --install-types --non-interactive --config-file={{.CONFIG_PYPROJECT}} .
        mypy --config-file={{.CONFIG_PYPROJECT}} .
      - prospector --messages-only --profile={{.CONFIG_PROSPECTOR}}
      - pyright --project={{.CONFIG_PYPROJECT}} .
    sources:
      - ./**/*.py
      - '{{.CONFIG_PYPROJECT}}'
      - '{{.CONFIG_PROSPECTOR}}'
    vars:
      CONFIG_PYPROJECT: '{{.CONFIG_DIR}}/pyproject.toml'
      CONFIG_PROSPECTOR: '{{.CONFIG_DIR}}/.prospector.yml'

  format:
    desc: Format Python code
    summary: |
      This task formats Python code using black, isort, and ruff.
    cmds:
      - black --quiet --config={{.CONFIG_PYPROJECT}} .
      - isort --quiet --settings-file={{.CONFIG_PYPROJECT}} .
      - ruff check --fix-only --config={{.CONFIG_PYPROJECT}} .
    sources:
      - ./**/*.py
      - '{{.CONFIG_PYPROJECT}}'
    vars:
      CONFIG_PYPROJECT: '{{.CONFIG_DIR}}/pyproject.toml'
      CONFIG_PROSPECTOR: '{{.CONFIG_DIR}}/.prospector.yml'

  test:
    desc: Run pytest
    summary: |
      This task runs all tests with pytest.
    cmds:
      - pytest {{.CLI_ARGS}}

  cover:
    desc: Generate test coverage report
    summary: |
      This task generates a test coverage report (currently not implemented).
    cmds:
      - echo "not implemented"

  clean:
    desc: Clean up temporary files
    summary: |
      This task cleans up temporary files created by python and pytest.
    cmds:
      - rm -rf .pytest_cache **/.pytest_cache **/__pycache__ .mypy_cache .ruff_cache
    shopt: [globstar]
